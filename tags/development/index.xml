<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>development on The Tymscar Blog</title><link>/tags/development/</link><description>Recent content in development on The Tymscar Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Thu, 18 Jan 2024 12:00:00 +0000</lastBuildDate><atom:link href="/tags/development/index.xml" rel="self" type="application/rss+xml"/><item><title>Soap sim</title><link>/posts/soapsim/</link><pubDate>Thu, 18 Jan 2024 12:00:00 +0000</pubDate><guid>/posts/soapsim/</guid><description>Soap sim in JS Your browser does not support the canvas element. Toggle JS simulation Reset JS simulation</description><content>&lt;h1 id="soap-sim-in-js">Soap sim in JS&lt;/h1>
&lt;script type="module" src="/soap-sim/index.js">&lt;/script>
&lt;div id="js-canvas-container" style="display: flex; justify-content: center; align-items: center; ">
&lt;canvas id="js-canvas" style="width: 100%; height: auto;">
Your browser does not support the canvas element.
&lt;/canvas>
&lt;/div>
&lt;div style="display: flex; justify-content: space-around; align-items: center; padding-top: 1em ">
&lt;button id="js-simulate-button">Toggle JS simulation&lt;/button>
&lt;button id="js-reset-button">Reset JS simulation&lt;/button>
&lt;/div></content></item><item><title>Critical Alert - Tech Industry Must Act on Job Market Chaos!</title><link>/posts/jobhunting/</link><pubDate>Wed, 10 Jan 2024 12:31:42 +0000</pubDate><guid>/posts/jobhunting/</guid><description>Applying to a job is a broken system This blog post is a call to action, urging reform in the tech recruitment process. It&amp;rsquo;s a shared struggle, demanding change for a more efficient and promising future in our industry.
Being genuine is not encouraged In the tech recruiting scene, a significant emphasis is placed on writing personalized cover letters. However, these letters, requiring genuine and thoughtful effort, are time-intensive to compose, sometimes demanding as much time as a full-time job, just for a chance at being noticed.</description><content>&lt;h1 id="applying-to-a-job-is-a-broken-system">Applying to a job is a broken system&lt;/h1>
&lt;p>This blog post is a call to action, urging reform in the tech recruitment process. It&amp;rsquo;s a shared struggle, demanding change for a more efficient and promising future in our industry.&lt;/p>
&lt;h4 id="being-genuine-is-not-encouraged">Being genuine is not encouraged&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173" alt="Cover letter">&lt;/p>
&lt;p>In the tech recruiting scene, a significant emphasis is placed on writing personalized cover letters. However, these letters, requiring genuine and thoughtful effort, are time-intensive to compose, sometimes demanding as much time as a full-time job, just for a chance at being noticed.&lt;/p>
&lt;p>Those who don&amp;rsquo;t spend time writing a genuine letter but resort to using templates, or ChatGPT have much better chances.&lt;/p>
&lt;h4 id="the-lemon-dilemma">The lemon dilemma&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1609196141706-91f4f03e1543" alt="Lemons">&lt;/p>
&lt;p>Recruiters often lack a deep understanding of the job requirements they list.&lt;/p>
&lt;p>For instance, if a job description asks for lemon expertise and a candidate mentions their proficiency in citruses but not lemons specifically, their application might be overlooked.&lt;/p>
&lt;p>This narrow focus on exact wording overlooks potentially qualified candidates and can be detrimental to the hiring process.&lt;/p>
&lt;h4 id="the-expert-novice-paradox">The expert novice paradox&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1520076794559-6a1229412a42" alt="Learning">&lt;/p>
&lt;p>Job requirements often resemble a jumble of buzzwords, seemingly optimized more for search engine visibility than for attracting the right candidate.&lt;/p>
&lt;p>Absurdities abound, such as demanding five years of experience in a technology that&amp;rsquo;s only been around for three. Conversely, basic skills like Git and command line proficiency are listed as requirements for senior roles, as if such skills could be absent at that level of expertise.&lt;/p>
&lt;h4 id="the-mustard-bottle-conundrum">The mustard bottle conundrum&lt;/h4>
&lt;img src="/job-hunting-2024/me_not_me.png" alt="An example of such question" style="aspect-ratio: 1;" />
&lt;p>Pre-interview questionnaires in tech hiring have evolved into something resembling a freshman psychology student&amp;rsquo;s meme.&lt;/p>
&lt;p>Candidates encounter bizarre questions like, &amp;ldquo;Are you more like a bottle of ketchup or mustard in your last major project contribution?&amp;rdquo; or are asked to choose between images, such as a spoon or a fork, to best represent themselves.&lt;/p>
&lt;p>These 60-question exercises seem more like a dive into abstract personality assessments than a relevant evaluation of professional skills.&lt;/p>
&lt;h4 id="the-quest-for-standardization">The quest for standardization&lt;/h4>
&lt;p>&lt;img src="/job-hunting-2024/forms.png" alt="Forms">&lt;/p>
&lt;p>One of the most frustrating aspects of tech job hunting is the redundancy of inputting basic personal details, already outlined in a CV, into various application forms.&lt;/p>
&lt;p>While these forms could easily refer to the CV for this information, many still require manual entry, sometimes even disabling the paste function.&lt;/p>
&lt;p>Platforms like Otta or LinkedIn have attempted to streamline this process with &amp;lsquo;quick apply&amp;rsquo; features, allowing candidates to fill out their profile once and submit it for multiple applications.&lt;/p>
&lt;p>However, this only works about 30% of the time. Many companies still insist on directing applicants to their websites, necessitating the repetitive task of typing out the same information.&lt;/p>
&lt;h4 id="the-illusion-of-advantage">The illusion of advantage&lt;/h4>
&lt;p>&lt;img src="/job-hunting-2024/linkedin-premium.png" alt="LinkedIn Premium">&lt;/p>
&lt;p>Job hunting platforms often offer premium, paid options, targeting those desperate for employment and promising enhanced visibility or chances.&lt;/p>
&lt;p>For instance, LinkedIn&amp;rsquo;s premium service—costing significantly more than a Netflix subscription—offers features like direct messaging anyone, regardless of connection status.&lt;/p>
&lt;p>However, despite crafting well-thought-out messages to reach recruiters or company owners, the reality is often disappointing. These messages frequently go unread, raising the question: who actively uses LinkedIn unless they&amp;rsquo;re job hunting themselves?&lt;/p>
&lt;h4 id="standing-out-a-double-edged-sword">Standing out: a double-edged sword&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1533032968297-a47e51cbdc93" alt="Standing out">&lt;/p>
&lt;p>In the tech job market, differentiation is key, yet it can also be a stumbling block.&lt;/p>
&lt;p>With countless engineers applying for top-tier positions, standing out is crucial. Advice on this includes crafting a CV that’s not just concise and clear, but also visually unique with elements like color or Feng Shui-inspired UTF characters.&lt;/p>
&lt;p>I created my own distinct, modern, and reader-friendly CV, but soon learned that resume-scanning bots prefer more traditional formats.&lt;/p>
&lt;p>To adapt, I even invested in a service that evaluated my CV’s likelihood of passing these automated screenings. Yet, even after conforming to a standard format, the response rate was disappointingly similar to that of my unique CV, demonstrating the unpredictability and challenge of balancing personal flair with system compatibility in the job hunt.&lt;/p>
&lt;h4 id="the-alchemy-of-cv-crafting">The alchemy of CV crafting&lt;/h4>
&lt;p>&lt;img src="/job-hunting-2024/my-cv.png" alt="My own CV">&lt;/p>
&lt;p>In the world of engineering, where logic and precision reign, creating a CV seems more like an art form, or even magic.Despite our skills in logical thinking and meticulous project planning, CV design demands a completely different set of abilities.&lt;/p>
&lt;p>Feedback on my CV has been polarizing; some criticize various aspects and suggest improvements, while others praise it as one of the best they&amp;rsquo;ve seen. This contradictory advice makes refining the CV feel like a step forward and a step back simultaneously.&lt;/p>
&lt;p>Ironically, in the rare instances when my CV bypasses the initial automated filters and I land an interview, recruiters often express admiration for it.&lt;/p>
&lt;p>The challenge lies not in the content of the CV, but in ensuring it&amp;rsquo;s seen by human eyes, rather than being dismissed by the unpredictable screening bots that stand as gatekeepers between candidates and potential employers.&lt;/p>
&lt;h4 id="the-mirage-of-abundant-job-listings">The mirage of abundant job listings&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1641497499382-f775ba7240ab" alt="Mirage">&lt;/p>
&lt;p>On job platforms, there seems to be an endless stream of opportunities, but increasingly, many of these listings are turning out to be phantom jobs.&lt;/p>
&lt;p>Companies often post these to maintain engagement or build a pool of interested candidates for future needs. My experience reflects this trend—I&amp;rsquo;ve received interview invitations from companies I applied to over six months ago, with the longest delay being ten months.&lt;/p>
&lt;p>Driven by curiosity, I set up a service in my home lab to track job postings on several large companies&amp;rsquo; boards. I observed a peculiar pattern: jobs being posted and removed at odd hours, like 4 AM on a Saturday, and the same positions reappearing every couple of weeks.&lt;/p>
&lt;p>Similarly, smaller companies repeatedly advertise the same mid-level engineer position, seemingly unable to fill it for months on end. This raises questions: Are there truly no suitable candidates among the thousands who apply? Or is it that these companies, like a 25-person startup supposedly hiring 30 mid-level engineers in a year, are not genuinely looking to fill these positions?&lt;/p>
&lt;h4 id="the-void-of-unreturned-effort">The void of unreturned effort&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1600453364898-255c24a205d2" alt="After work">&lt;/p>
&lt;p>The job application process often involves an immense personal investment: meticulously tailoring a CV for each role, writing thoughtful cover letters, and enduring up to five rounds of interviews, only to be met with a deafening silence.&lt;/p>
&lt;p>No offer, no rejection, no feedback - not even a courtesy &amp;ldquo;thank you.&amp;rdquo; This scenario is frustratingly common, especially when you&amp;rsquo;ve successfully navigated through all the behavioral and technical interviews, seemingly forming a good rapport with the team.&lt;/p>
&lt;p>In such instances, it&amp;rsquo;s reasonable to expect at least a brief explanation of the decision. The absence of closure not only leaves candidates in limbo but also suggests they might merely be backup options, perhaps to be contacted much later.&lt;/p>
&lt;p>This lack of communication in the recruitment process, after candidates have invested countless hours, reflects a disregard for their time and effort.&lt;/p>
&lt;h4 id="the-priceless-hours-of-unemployment">The priceless hours of unemployment&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1580519542036-c47de6196ba5" alt="Money">&lt;/p>
&lt;p>It&amp;rsquo;s a paradox in the job market: while companies are prepared to offer salaries acknowledging the value of an employee&amp;rsquo;s work hours, they simultaneously expect candidates to invest significant unpaid time in the recruitment process.&lt;/p>
&lt;p>This includes spending 5, 20, or even over 50 hours on homework projects without any assurance of employment, even if the work is well-received.&lt;/p>
&lt;p>In addition, there&amp;rsquo;s an expectation for candidates to thoroughly research the company, often to an unreasonable degree. For instance, not knowing the name of the company&amp;rsquo;s first CTO can be seen as a lack of interest, a criterion I&amp;rsquo;ve personally encountered several times.&lt;/p>
&lt;p>The irony is stark when you&amp;rsquo;re unemployed, every hour is precious, yet you&amp;rsquo;re expected to give them away for free in the hope of securing a job.&lt;/p>
&lt;p>And let&amp;rsquo;s not forget the obligatory LeetCode grind, a topic already well-trodden in other discussions but indicative of the extensive preparation expected in today&amp;rsquo;s job market.&lt;/p>
&lt;h4 id="payday-plot-twist-senior-roles-minimum-wages">Payday plot twist: senior roles, minimum wages&lt;/h4>
&lt;p>&lt;img src="https://plus.unsplash.com/premium_photo-1682309623835-d15358bcb195" alt="Stock prices">&lt;/p>
&lt;p>Navigating the job market often comes with an unwelcome surprise towards the end - the salary discussion.&lt;/p>
&lt;p>In some countries, candidates have the advantage of knowing salary ranges upfront, but for many, this information is obscured until after enduring 5-7 rounds of interviews.&lt;/p>
&lt;p>The revelation can be jarring, especially when the offered salary is significantly lower than previous compensation. I&amp;rsquo;ve personally experienced offers of minimum wage for senior positions five times in the last six months.&lt;/p>
&lt;p>This practice seems to exploit the desperation that the flawed system breeds in job seekers, with companies leveraging this to offer substantially lower salaries, knowing that some candidates, worn down by the process, might reluctantly accept.&lt;/p>
&lt;h4 id="risky-business-the-startup-salary-paradox">Risky business: the startup salary paradox&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1559136555-9303baea8ebd" alt="Startups">&lt;/p>
&lt;p>When applying to smaller companies and startups, one might expect a streamlined interview process, potentially leading to exciting work and competitive salaries.&lt;/p>
&lt;p>However, my experience has painted a different picture. Startups often offer surprisingly low base salaries, compensating the difference with stock options that may or may not bear fruit.&lt;/p>
&lt;p>Moreover, the technical direction, often rigidly set by CTOs, can be inflexible and driven more by personal whims than practicality.&lt;/p>
&lt;p>I&amp;rsquo;ve encountered offers from startups that demanded long hours (10-12 a day), personal equipment provisions, and an all-consuming commitment to the company ethos, all for a salary that&amp;rsquo;s hard to justify.&lt;/p>
&lt;p>I was told I need to live and breathe &lt;em>company name&lt;/em>&amp;hellip;&lt;/p>
&lt;h4 id="referral-roulette-navigating-networkings-nuances">Referral roulette: navigating networking&amp;rsquo;s nuances&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1564415051543-cb73a7468103" alt="Referral">&lt;/p>
&lt;p>The common advice in job hunting is &amp;ldquo;it&amp;rsquo;s not what you know, but who you know.&amp;rdquo;&lt;/p>
&lt;p>Despite being referred to several companies, challenges and inconsistencies arose.&lt;/p>
&lt;p>My first referral was unsuccessful due to a broken referral process; they discarded my application for lacking additional information, which their system couldn&amp;rsquo;t accommodate.&lt;/p>
&lt;p>In two other cases, I completed all interview rounds, one stretching over three months, only to be rejected. The feedback was puzzling—they claimed I lacked experience in large companies, despite my history with firms 20 times their size.&lt;/p>
&lt;p>For the fourth referral, I was denied an interview because I had previously applied and was rejected without a CV review, and company policy required a year&amp;rsquo;s gap before reapplying.&lt;/p>
&lt;h4 id="the-perfect-fit-fallacy">The perfect fit fallacy&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1605712916066-e143c317df72" alt="Puzzle piece">&lt;/p>
&lt;p>In the tech job market, being almost a perfect match isn&amp;rsquo;t enough.&lt;/p>
&lt;p>If you lack familiarity with even one minor tool they use, your chances diminish, regardless of your passion or willingness to learn it on your own time.&lt;/p>
&lt;p>Many companies don&amp;rsquo;t seem to value the desire to grow and adapt; instead, they seek an immediate, precise fit—a candidate who meets the current needs and can be easily replaced when no longer necessary.&lt;/p>
&lt;p>This approach overlooks the potential of passionate, adaptable candidates, favoring a &amp;lsquo;perfect fit&amp;rsquo; mindset in a market flooded with options, where the next &amp;lsquo;perfect&amp;rsquo; candidate is always waiting in the wings.&lt;/p>
&lt;h4 id="bait-and-switch-the-job-description-dilemma">Bait and switch: the job description dilemma&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1681812508855-f7b04fefcd83" alt="Mechanic">&lt;/p>
&lt;p>The tech job market is rife with instances of misleading job descriptions.&lt;/p>
&lt;p>It&amp;rsquo;s become all too common to apply for a specific role, only to be informed later in the process that the position is no longer available, or its scope has dramatically changed.&lt;/p>
&lt;p>For example, I applied for a backend position, but after three interviews, the company shifted its focus, seeking an ML engineer instead.&lt;/p>
&lt;p>Another common tactic is to claim that the job posting is outdated and that they need a different skill set, subtly implying that the candidate is at fault for not adapting.&lt;/p>
&lt;p>This approach can make applicants feel unreasonable for turning down a role that doesn&amp;rsquo;t match their skills or career goals, leveraging the pressure of a competitive job market to their advantage.&lt;/p>
&lt;h4 id="the-paradox-of-the-peaceful-professional-conflict-as-a-credential">The paradox of the peaceful professional: conflict as a credential&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1544717301-9cdcb1f5940f" alt="Office rage">&lt;/p>
&lt;p>In the current job interview landscape, there&amp;rsquo;s an ironic twist: those who engage in workplace conflicts might have an edge.&lt;/p>
&lt;p>Standard interview questions often probe for experiences resolving prolonged conflicts with colleagues. Those who frequently find themselves in such situations can draw from real examples or lessons learned.&lt;/p>
&lt;p>Conversely, for those who are naturally non-confrontational, cooperative, and avoid workplace disputes, this becomes a disadvantage. They might be perceived as lacking in a key area of experience.&lt;/p>
&lt;p>Moreover, individuals adept at fabricating stories can create compelling narratives about resolving fictional conflicts, positioning themselves as problem-solvers.&lt;/p>
&lt;p>This dynamic places individuals who foster harmonious work environments at a seeming disadvantage, as their lack of conflict is misconstrued as a lack of experience in conflict resolution.&lt;/p>
&lt;h4 id="rules-for-thee-not-for-me-the-interview-table-turns">Rules for thee, not for me: the interview table turns&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1589994965851-a8f479c573a9" alt="Rules statue">&lt;/p>
&lt;p>Frustrated with the repetitive nature of interview questions, I decided to flip the script during my interviews.
When it was my turn to ask questions, I posed the same types of queries that interviewers typically ask candidates.&lt;/p>
&lt;p>The results were eye-opening. Many interviewers struggled to respond, and those who did often gave answers that were either underwhelming or raised serious red flags about the company culture.&lt;/p>
&lt;p>More startling was the technical inadequacy revealed when I asked senior engineers basic questions about system architecture or common tools like Redis and Docker.&lt;/p>
&lt;p>Their inability to answer such fundamental questions exposed a concerning knowledge gap in roles where expertise should be a given, underscoring a troubling disparity in the expectations set for candidates versus those demonstrated by current employees.&lt;/p>
&lt;h4 id="when-interviewers-warn-you-off">When interviewers warn you off&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1511737207395-5b1ff1f86e54" alt="Danger sign">&lt;/p>
&lt;p>In my job search, particularly with smaller companies and startups, I&amp;rsquo;ve encountered a startling trend where interviewers dissuade me from joining their team.&lt;/p>
&lt;p>Some have candidly shared their experiences of being overworked, while others described their workplace as merely a temporary stop, not suitable for someone with a genuine passion for technology.&lt;/p>
&lt;p>A few were enthusiastic about having me on board but were upfront about the drawbacks: excessive stress, lack of annual raises, no input on projects, and even instances of being bullied by CTOs.&lt;/p>
&lt;p>These admissions have led me to decline such offers, and I can&amp;rsquo;t help but sympathize with those who, due to circumstances, don&amp;rsquo;t have the option to hold out for a more suitable and fulfilling job opportunity.&lt;/p>
&lt;h4 id="the-employment-tightrope">The employment tightrope&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1590641531727-3e65c2a08a77" alt="Tightrope">&lt;/p>
&lt;p>In the current job market, there&amp;rsquo;s a tricky balancing act when considering a career move.&lt;/p>
&lt;p>A gap of just a few months on your CV can be seen as a red flag, making it harder to secure interviews. Similarly, leaving a job before the two-year mark is often viewed with suspicion, leading to your CV being passed over.&lt;/p>
&lt;p>This creates a toxic catch-22: stay unemployed and you risk being seen as less employable due to gaps, but accept a subpar offer too hastily and you might find yourself stuck in a role with low pay, no growth potential, a toxic work environment, and mediocre technical challenges.&lt;/p>
&lt;p>Leaving such a position too soon only compounds the problem, as it can hinder future job prospects.&lt;/p>
&lt;p>This situation forces job seekers into a difficult choice between settling for a less-than-ideal role or facing potential stigmatization for seeking better opportunities.&lt;/p>
&lt;h4 id="temporary-troubles">Temporary troubles&lt;/h4>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1533749047139-189de3cf06d3" alt="Clocks">&lt;/p>
&lt;p>Seeking part-time work while job hunting in the tech industry often seems like a practical solution, but it comes with its own set of challenges.&lt;/p>
&lt;p>The job search itself is a demanding full-time endeavor, consuming vast amounts of time and mental energy. Even dedicating half your day to it can be taxing.&lt;/p>
&lt;p>However, the part-time job market is fraught with problematic contracts. I&amp;rsquo;ve encountered agreements claiming ownership of any personal projects developed in my free time. Others stipulate needing their approval to accept any additional part-time or full-time work. Some contracts even prevent a quick exit, requiring a three-month notice period.&lt;/p>
&lt;p>This creates a treacherous landscape for those looking for temporary work. The harsh reality is, if you&amp;rsquo;re unwilling to accept these stringent conditions, there are always others more desperate who will, making the part-time job market a challenging and often exploitative field to navigate.&lt;/p>
&lt;h1 id="urgent-reform-needed-breaking-the-destructive-cycle">Urgent reform needed: breaking the destructive cycle&lt;/h1>
&lt;p>&lt;img src="https://images.unsplash.com/photo-1588268393007-068bc70a443d" alt="Emergency">&lt;/p>
&lt;p>The state of the job market, particularly in engineering, is reaching a critical point.&lt;/p>
&lt;p>Morale among engineers is at an all-time low, and surprisingly, companies are also feeling the impact.&lt;/p>
&lt;p>The current recruitment and hiring processes tend to favor those who have connections or know how to manipulate the system, resulting in a workforce that is often less engaged, less productive, and less innovative. This perpetuates a downward spiral, as the very individuals responsible for these systems are often the ones benefitting from them.&lt;/p>
&lt;p>Many talented engineers are choosing to start their own businesses, leaving a vacuum in larger companies.&lt;/p>
&lt;p>In the short term, passionate and dedicated engineers who aren&amp;rsquo;t interested in management or entrepreneurship are the ones losing out. In the long term, it&amp;rsquo;s the larger companies that suffer from a brain drain, as they struggle to retain or attract genuinely committed and skilled talent.&lt;/p>
&lt;p>&lt;b>This cycle needs to be broken for the health of the industry and its professionals.&lt;/b>&lt;/p></content></item><item><title>How I deploy private GitHub projects to local self-hosted servers (CI/CD)</title><link>/posts/privategithubcicd/</link><pubDate>Sat, 12 Aug 2023 18:04:45 +0100</pubDate><guid>/posts/privategithubcicd/</guid><description>How I deploy private GitHub projects to local self-hosted servers (CI/CD) I have a lot of experience with massive CI/CD pipelines that deploy private code to public servers. I&amp;rsquo;ve also worked with pipelines that deploy public repositories to private servers, such as my homelab. However, I never experimented with a pipeline that takes a private GitHub repo, builds it, and deploys it to a server on the LAN. That&amp;rsquo;s precisely what I needed for a project I&amp;rsquo;m currently working on that isn&amp;rsquo;t yet public.</description><content>&lt;h1 id="how-i-deploy-private-github-projects-to-local-self-hosted-servers-cicd">How I deploy private GitHub projects to local self-hosted servers (CI/CD)&lt;/h1>
&lt;p>I have a lot of experience with massive CI/CD pipelines that deploy private code to public servers. I&amp;rsquo;ve also worked with pipelines that deploy public repositories to private servers, such as my homelab. However, I never experimented with a pipeline that takes a private GitHub repo, builds it, and deploys it to a server on the LAN. That&amp;rsquo;s precisely what I needed for a project I&amp;rsquo;m currently working on that isn&amp;rsquo;t yet public.&lt;/p>
&lt;p>I took some time to design the best method for this. The two top ideas were: running a self-hosted GitHub Actions runner, which would then redeploy the service in the same LAN as the runner, or hosting a Docker container on a Proxmox VM. This container would act as a webhook and later redeploy the service on the same VM. I chose the second option because it offers more flexibility for future scenarios, such as deploying from repositories hosted on other platforms like GitLab.&lt;/p>
&lt;p>Here&amp;rsquo;s what the workflow looks like:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ascii" data-lang="ascii"> +---------------------+
| Code gets modified |
| and commited to the |
| github repository |
+----------+----------+
|
v
+------------------+
| A github action |
| script downloads |
| builds and lints |
| the code |
+--------+---------+
|
v
+----------------------+
| This POST request is |
| then routed through |
| a cloudflare tunnel |
+----------+-----------+
|
v
+------------------------+
| If all of that |
| passes successfully |
| send the redeploy |
| command to the webhook |
| container |
+-----------+------------+
|
v
+------------------------+
| The webhook container |
| now inside of the lan |
| SSH&amp;#39;es into the host |
| VM and recreates the |
| project docker compose |
| stack |
+-----------+------------+
|
v
+----------------------+
| The project docker |
| compose has a custom |
| entrypoint that gets |
| run every time it is |
| recreated |
+----------+-----------+
|
v
+------------------------+
| This entrypoint script |
| loads the private key |
| approved by github, |
| downloads the repo, |
| build the project, |
| and serves it locally |
+-----------+------------+
|
v
+--------------------------------+
| Because of some extra |
| traefik configuration |
| parametres in the docker |
| compose file, the project |
| is then exposed on the lan |
| behind a valid SSL certificate |
+--------------------------------+
&lt;/code>&lt;/pre>&lt;h2 id="the-github-action">The GitHub Action&lt;/h2>
&lt;p>Creating a GitHub Action is straightforward. You need to create a YAML file that instructs GitHub what to do. In our case, we want it to execute every time code is committed to &lt;code>main&lt;/code>.&lt;/p>
&lt;p>The filename isn&amp;rsquo;t crucial, but its location is. Mine is in the &lt;code>.github/workflows&lt;/code> directory in the repo and is named &lt;code>build_and_publish.yaml&lt;/code>.&lt;/p>
&lt;p>The YAML is relatively easy to understand; it has two jobs. One job downloads, builds, and lints the code. The other, &amp;ldquo;publish&amp;rdquo;, triggers the webhook in our local LAN to republish the project. The &amp;ldquo;publish&amp;rdquo; job only executes if the &amp;ldquo;build&amp;rdquo; job completes without errors.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Build and Publish&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">push&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">branches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">jobs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">runs-on&lt;/span>: &lt;span style="color:#ae81ff">ubuntu-latest&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">steps&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Checkout code&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uses&lt;/span>: &lt;span style="color:#ae81ff">actions/checkout@v2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Use Node.js&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uses&lt;/span>: &lt;span style="color:#ae81ff">actions/setup-node@v2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">with&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">node-version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;18&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Install Dependencies&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">npm ci&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Lint&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">npm run lint&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Build&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">npm run build&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">publish&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">runs-on&lt;/span>: &lt;span style="color:#ae81ff">ubuntu-latest&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">needs&lt;/span>: &lt;span style="color:#ae81ff">build&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">steps&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Trigger Webhook&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> RESPONSE=$(curl -X POST https://webhook.tymsc.ar/hooks/redeploy)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> echo &amp;#34;$RESPONSE&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="the-cloudflare-tunnel-and-the-webhook-container">The Cloudflare tunnel and the webhook container&lt;/h2>
&lt;p>The tunnel&amp;rsquo;s purpose is to avoid exposing my local LAN&amp;rsquo;s homelab ports to the internet. With a Cloudflare tunnel, I can control any exposed service and manage its traffic.&lt;/p>
&lt;p>I chose to host both the tunnel and the webhook container on a VM in my local Proxmox server using Docker Compose. Here&amp;rsquo;s the &lt;code>docker-compose.yml&lt;/code> for them:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;3.3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">webhook&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">context&lt;/span>: &lt;span style="color:#ae81ff">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dockerfile&lt;/span>: &lt;span style="color:#ae81ff">Dockerfile&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">webhook&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">PUID=1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">PGID=1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Europe/London&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">EXTRA_PARAM=-hotreload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">/root/webhook:/config&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">/root/webhook/secrets/webhook_id_rsa:/etc/ssh_keys/id_rsa:rw&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.enable=true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook.entrypoints=http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook.rule=Host(`webhook.tymsc.ar`)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.middlewares.webhook-https-redirect.redirectscheme.scheme=https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook.middlewares=webhook-https-redirect&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook-secure.entrypoints=https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook-secure.rule=Host(`webhook.tymsc.ar`)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook-secure.tls=true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.webhook-secure.service=webhook&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.services.webhook.loadbalancer.server.port=9000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.docker.network=proxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">proxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">restart&lt;/span>: &lt;span style="color:#ae81ff">always&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tunnel&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">cloudflared-tunnel-webhook&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">cloudflare/cloudflared&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">restart&lt;/span>: &lt;span style="color:#ae81ff">unless-stopped&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">tunnel run&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TUNNEL_TOKEN= ### SECRET KEY HERE&lt;/span> &lt;span style="color:#75715e">###&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">proxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">external&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Any &lt;code>labels&lt;/code> you see are optional. I included them to route internal traffic and assign SSL certificates.&lt;/p>
&lt;p>&lt;code>PUID&lt;/code> and &lt;code>PGID&lt;/code> labels are there to grant necessary permissions to the webhook user later.&lt;/p>
&lt;p>The &lt;code>TUNNEL_TOKEN&lt;/code> variable is the key from Cloudflare you get when creating a tunnel. To get yours, visit Cloudflare -&amp;gt; Zero Trust -&amp;gt; Access -&amp;gt; Tunnels, and establish a tunnel with your desired URL, in my case, &lt;code>webhook.tymsc.ar&lt;/code>.&lt;/p>
&lt;p>Because the tunnel and webhook service are defined in this Docker Compose file, they can reference each other by name. So, in the Cloudflare online console, when you create the tunnel, set the Service parameter to &lt;code>http://webhook:9000&lt;/code>. 9000 is the default port for &lt;code>roxedus/webhook&lt;/code>.&lt;/p>
&lt;p>An observant reader might notice the webhook container uses a Dockerfile instead of a container name. That&amp;rsquo;s because I needed SSH access on that container, and the base container didn&amp;rsquo;t have it. So, I added it. Here&amp;rsquo;s the Dockerfile:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> roxedus/webhook&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> apk --no-cache add openssh-client&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here&amp;rsquo;s the folder structure for the webhook service:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- Dockerfile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- docker-compose.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- hooks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>| &lt;span style="color:#e6db74">`&lt;/span>-- hooks.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- scripts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>| &lt;span style="color:#e6db74">`&lt;/span>-- redeploy.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">`&lt;/span>-- secrets
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">`&lt;/span>-- webhook_id_rsa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We discussed the first two, but what about the others?&lt;/p>
&lt;p>&lt;code>webhook_id_rsa&lt;/code> inside &lt;code>secrets&lt;/code> is the SSH key allowing this container to SSH into the Proxmox VM hosting it, and the project&amp;rsquo;s container we want to deploy.&lt;/p>
&lt;p>The &lt;code>hooks/hooks.json&lt;/code> file has a definition of hooks and their actions. Currently, there&amp;rsquo;s only one hook, &lt;code>redeploy&lt;/code>, which executes the &lt;code>redeploy.sh&lt;/code> script in the scripts directory.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>[
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;redeploy&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;execute-command&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/config/scripts/redeploy.sh&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;command-working-directory&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/config/scripts&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;response-message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;✅ Redeploying project!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>COMMAND&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;nohup docker compose -f /root/project/docker-compose.yml up --force-recreate --build -d &amp;amp;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HOST_IP&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>ip route | awk &lt;span style="color:#e6db74">&amp;#39;/default/ { print $3 }&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh-keyscan $HOST_IP &amp;gt; /root/.ssh/known_hosts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh -i /etc/ssh_keys/id_rsa root@$HOST_IP -o StrictHostKeyChecking&lt;span style="color:#f92672">=&lt;/span>no -o UserKnownHostsFile&lt;span style="color:#f92672">=&lt;/span>/dev/null $COMMAND
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="the-project-container">The project container&lt;/h2>
&lt;p>This is much simpler than the webhook container. Here&amp;rsquo;s its folder structure:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- Dockerfile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- docker-compose.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>|-- entrypoint.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">`&lt;/span>-- secrets
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">`&lt;/span>-- id_rsa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>secrets/id_rsa&lt;/code> file is an SSH private key allowing us to download a private GitHub repository. Its public counterpart was uploaded to GitHub.&lt;/p>
&lt;p>Here&amp;rsquo;s the &lt;code>docker-compose.yml&lt;/code> file for the project container:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">project&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">context&lt;/span>: &lt;span style="color:#ae81ff">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dockerfile&lt;/span>: &lt;span style="color:#ae81ff">Dockerfile&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">project&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;5000:5000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">/root/project/secrets:/secrets&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.enable=true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project.entrypoints=http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project.rule=Host(`project.tymsc.ar`)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.middlewares.project-https-redirect.redirectscheme.scheme=https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project.middlewares=project-https-redirect&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project-secure.entrypoints=https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project-secure.rule=Host(`project.tymsc.ar`)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project-secure.tls=true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.routers.project-secure.service=project&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.http.services.project.loadbalancer.server.port=5000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;traefik.docker.network=proxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">proxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">restart&lt;/span>: &lt;span style="color:#ae81ff">always&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">external&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Like before, the &lt;code>labels&lt;/code> are optional. They&amp;rsquo;re there to access &lt;code>project.tymsc.ar&lt;/code> locally, with SSL certificates handled by Traefik.&lt;/p>
&lt;p>The critical part is the secrets passed as a volume and the use of a custom Dockerfile. Here&amp;rsquo;s the Dockerfile:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> node:18&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">WORKDIR&lt;/span>&lt;span style="color:#e6db74"> /app&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> apt-get update &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get install -y git openssh-client &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> npm install -g serve&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> entrypoint.sh /entrypoint.sh&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> chmod +x /entrypoint.sh&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">EXPOSE&lt;/span>&lt;span style="color:#e6db74"> 5000&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">CMD&lt;/span> [&lt;span style="color:#e6db74">&amp;#34;/entrypoint.sh&amp;#34;&lt;/span>]&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>As you can see, each time this runs, it calls an &lt;code>entrypoint.sh&lt;/code> script. This ensures tasks inside it execute every time this container is recreated. As you now know, this happens every time the webhook is called. Let&amp;rsquo;s look at the script:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkdir -p ~/.ssh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp /secrets/id_rsa ~/.ssh/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#ae81ff">600&lt;/span> ~/.ssh/id_rsa
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ssh-keyscan github.com &amp;gt;&amp;gt; ~/.ssh/known_hosts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git clone git@github.com:tymscar/project.git /app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cd /app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npm install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npm run build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>serve -s build -p &lt;span style="color:#ae81ff">5000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The first half of it handles the SSH keys for the private repo and downloads the project, while the last half installs the dependencies, builds it, and serves it to the LAN. At that point, if you go to the IP of the VM where you&amp;rsquo;re running this container and access port 5000, you should be able to see your project. Because I have the traefik labels set up, I can go to project.tymsc.ar and see it there.&lt;/p>
&lt;p>And that&amp;rsquo;s basically it.&lt;/p>
&lt;h2 id="thoughts">Thoughts&lt;/h2>
&lt;p>The beauty of this approach is that if later down the line I want to do this with another private project, all I need to do is add another hook to the webhook container, create the project container just like this last one, and make sure the project has a GitHub action that triggers the webhook.&lt;/p>
&lt;p>The best part is that this is not GitHub-specific either. If later down the line I want to move to GitLab, or I have a self-hosted Gitea instance, the same logic would apply. I would just need to find a way to trigger the webhook on a merge to the main branch.&lt;/p></content></item><item><title>Running Jetbrains remote dev servers on NixOS</title><link>/posts/jetbrainsremotedevservernixos/</link><pubDate>Mon, 10 Jul 2023 00:33:45 +0100</pubDate><guid>/posts/jetbrainsremotedevservernixos/</guid><description>EDIT: I have raised a PR to fix this upstream and got it merged, so you don&amp;rsquo;t have to follow the guide anymore, you can just use the package on nixpkgs unstable for the time being and later on in the future, a stable branch.
For the past year or so I have been very interested in NixOS and Nix in general. I have set it up as my main OS on my desktop, I have used it on remote VPS instances, and I have used it for local projects as well in the shape of nix environments.</description><content>&lt;p>&lt;img src="/jb-nix-remote-server/project.png" alt="A remote project">&lt;/p>
&lt;p>EDIT: I have raised &lt;a href="https://github.com/NixOS/nixpkgs/pull/243533">a PR to fix this&lt;/a> upstream and got it merged, so you don&amp;rsquo;t have to follow the guide anymore, you can just use the package on nixpkgs unstable for the time being and later on in the future, a stable branch.&lt;/p>
&lt;p>For the past year or so I have been very interested in &lt;a href="https://nixos.org/">NixOS and Nix&lt;/a> in general.
I have set it up as my &lt;a href="https://github.com/tymscar/dotfiles">main OS on my desktop&lt;/a>, I have used it on remote VPS instances, and I have used it for local projects as well in the shape of nix environments.&lt;/p>
&lt;p>However there has always been an issue, and that is hosting a remote Jetbrains instance on it that I can then connect to from anywhere else.&lt;/p>
&lt;p>Long story short, the way it works is when a client tries to connect to the server, it checks to see if there is any instance of a Jetbrains IDE running.
If there is none, it tries to start one. All good up to this point, however, here is where the problems start: If there is no IDE present, or if it can&amp;rsquo;t detect it, it sends over a package and it tries installing that, and because NixOS is not your standard Linux distro, it fails every time.&lt;/p>
&lt;p>I have looked far and wide online and there hasn&amp;rsquo;t been a good solution until I found this issue on GitHub: &lt;a href="https://github.com/NixOS/nixpkgs/issues/153335">https://github.com/NixOS/nixpkgs/issues/153335&lt;/a>&lt;/p>
&lt;p>None of the solutions there were made specifically for Webstorm, which is what I needed, but the one by &lt;a href="https://github.com/NixOS/nixpkgs/issues/153335#issuecomment-1465833977">Nicolas Guilloux&lt;/a>, for PHPStorm, was something that in the end managed to work.&lt;/p>
&lt;p>I have then spent a handful of hours trying to understand how does the patch work and why is it needed because I wanted to see if I can simplify it to make it less likey to break in future updates.&lt;/p>
&lt;p>I managed to boil it down to 2 modification, and looking back through the history as far as I had patience for, this new patch seems to work with all of the previous versions, which gives me hope that it will continue to work in the future.&lt;/p>
&lt;p>Here is my modified patch, if you want to follow along, save this as &lt;code>JetbrainsRemoteDev.patch&lt;/code> in the same folder as your nix config:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-diff" data-lang="diff">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">--- a/plugins/remote-dev-server/bin/launcher.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#a6e22e">+++ b/plugins/remote-dev-server/bin/launcher.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">&lt;/span>&lt;span style="color:#75715e">@@ -327,6 +327,8 @@
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> REMOTE_DEV_SERVER_USE_SELF_CONTAINED_LIBS=1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+REMOTE_DEV_SERVER_USE_SELF_CONTAINED_LIBS=0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">&lt;/span> if [ $REMOTE_DEV_SERVER_USE_SELF_CONTAINED_LIBS -eq 1 ]; then
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SELFCONTAINED_LIBS=&amp;#34;$REMOTE_DEV_SERVER_DIR/selfcontained/lib&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> if [ ! -d &amp;#34;$SELFCONTAINED_LIBS&amp;#34; ]; then
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">@@ -568,3 +570,5 @@
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &amp;#34;$LAUNCHER&amp;#34; &amp;#34;$STARTER_COMMAND&amp;#34; &amp;#34;$PROJECT_PATH&amp;#34; &amp;#34;$@&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ;;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> esac
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">+unset REMOTE_DEV_SERVER_USE_SELF_CONTAINED_LIBS
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>I have spent a few hours trying to see if I can get it to work without the patch at all by setting the command line option myself before running the server, or doing it in the overlay, but it would fail either because the variable would be set to 1 and it wouldn&amp;rsquo;t find the libraries (in the store) or because the variable was 0 and at the end of the launch script it would still be set and used by the IDE later down the line.&lt;/p>
&lt;p>I have also made a few modifications to the overlay which would give you the opportunity of selecting multiple Jetbrains IDEs that you would want to use as remote servers. It worked with all of the ones I have tried.&lt;/p>
&lt;p>If you&amp;rsquo;re following at home, you just have to add the overlay to your config, for example as such:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-elixir" data-lang="elixir">&lt;span style="display:flex;">&lt;span>nixpkgs&lt;span style="color:#f92672">.&lt;/span>overlays &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#e6db74">final&lt;/span>: &lt;span style="color:#e6db74">prev&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> let
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> toolNames &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#e6db74">&amp;#34;phpstorm&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;webstorm&amp;#34;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> makeToolOverlay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">toolName&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>{toolName} &lt;span style="color:#f92672">=&lt;/span> prev&lt;span style="color:#f92672">.&lt;/span>jetbrains&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>{toolName}&lt;span style="color:#f92672">.&lt;/span>overrideAttrs (&lt;span style="color:#e6db74">old&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> patches &lt;span style="color:#f92672">=&lt;/span> (old&lt;span style="color:#f92672">.&lt;/span>patches &lt;span style="color:#f92672">or&lt;/span> []) &lt;span style="color:#f92672">++&lt;/span> [ &lt;span style="color:#f92672">./&lt;/span>&lt;span style="color:#a6e22e">JetbrainsRemoteDev&lt;/span>&lt;span style="color:#f92672">.&lt;/span>patch ];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> installPhase &lt;span style="color:#f92672">=&lt;/span> (old&lt;span style="color:#f92672">.&lt;/span>installPhase &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> makeWrapper &lt;span style="color:#e6db74">&amp;#34;$out/$pname/bin/remote-dev-server.sh&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;$out/bin/$pname-remote-dev-server&amp;#34;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">--&lt;/span>prefix &lt;span style="color:#a6e22e">PATH&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;$out/libexec/$pname:${final.lib.makeBinPath [ final.jdk final.coreutils final.gnugrep final.which final.git ]}&amp;#34;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">--&lt;/span>prefix &lt;span style="color:#a6e22e">LD_LIBRARY_PATH&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;${final.lib.makeLibraryPath ([ final.stdenv.cc.cc.lib final.libsecret final.e2fsprogs final.libnotify ])}&amp;#34;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">--&lt;/span>set&lt;span style="color:#f92672">-&lt;/span>default &lt;span style="color:#a6e22e">JDK_HOME&lt;/span> &lt;span style="color:#e6db74">&amp;#34;${final.jetbrains.jdk}&amp;#34;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">--&lt;/span>set&lt;span style="color:#f92672">-&lt;/span>default &lt;span style="color:#a6e22e">JAVA_HOME&lt;/span> &lt;span style="color:#e6db74">&amp;#34;${final.jetbrains.jdk}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">in&lt;/span> { jetbrains &lt;span style="color:#f92672">=&lt;/span> prev&lt;span style="color:#f92672">.&lt;/span>jetbrains &lt;span style="color:#f92672">//&lt;/span> builtins&lt;span style="color:#f92672">.&lt;/span>foldl&lt;span style="color:#e6db74">&amp;#39; (acc: toolName: acc // makeToolOverlay toolName) {} toolNames; })
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">];&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>Now all you have to do is add your favourite Jetbrains IDE to the &lt;code>toolNames&lt;/code> list and don&amp;rsquo;t forget to add it to your packages list as well, for example:
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-elixir" data-lang="elixir">&lt;span style="display:flex;">&lt;span>environment&lt;span style="color:#f92672">.&lt;/span>systemPackages &lt;span style="color:#f92672">=&lt;/span> with pkgs; [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># other packages here...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> jetbrains&lt;span style="color:#f92672">.&lt;/span>webstorm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> jetbrains&lt;span style="color:#f92672">.&lt;/span>phpstorm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> jetbrains&lt;span style="color:#f92672">.&lt;/span>jdk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;p>Note &lt;code>jetbrains.jdk&lt;/code> being there! Without it, none of this works, so do not forget to add it there!&lt;/p>
&lt;p>Now you need to &lt;code>sudo nixos-rebuild switch&lt;/code> and start the server. The naming of the utility depends on the IDE you want to use, in my case &lt;code>webstorm-remote-dev-server run &amp;lt;path to project&amp;gt;&lt;/code>.&lt;/p>
&lt;p>That is all, now you can just open up Jetbrains Gateway, go to the SSH tab and just connect to your instance by clicking on the project. It will be the one selected with the previous command!&lt;/p>
&lt;p>&lt;img src="/jb-nix-remote-server/projects.png" alt="Project list">&lt;/p></content></item></channel></rss>